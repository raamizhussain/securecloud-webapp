<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Activity Logs - Admin - SecureCloud Corp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .log-entry {
            border-left: 4px solid #0d6efd;
            transition: all 0.2s;
        }
        .log-entry:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        .log-success { border-left-color: #198754; }
        .log-failed { border-left-color: #dc3545; }
        .log-warning { border-left-color: #ffc107; }
        .timeline-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #0d6efd;
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üîí SecureCloud Security Suite</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('profile') }}">Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('admin') }}">Admin Panel</a></li>
                    <li class="nav-item"><a class="nav-link active" href="{{ url_for('admin_activity_logs') }}">System Logs</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1>üîê System Activity Logs (Admin)</h1>
                <p class="text-muted">Monitor all user activity across the platform</p>
            </div>
            <div>
                <span class="badge bg-danger">ADMIN VIEW</span>
                <span class="badge bg-primary ms-2">{{ logs|length }} Showing</span>
            </div>
        </div>

        <!-- Filter Options -->
        <div class="card mb-4">
            <div class="card-header bg-warning">
                <strong>‚ö†Ô∏è Security Monitoring Dashboard</strong> - All system activity
            </div>
            <div class="card-body">
                <form method="GET" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Username</label>
                        <select name="username" class="form-select">
                            <option value="">All Users</option>
                            {% for u in users %}
                            <option value="{{ u.username }}">{{ u.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Action Type</label>
                        <select name="action" class="form-select">
                            <option value="">All Actions</option>
                            <option value="login">Login</option>
                            <option value="login_attempt">Login Attempt (Failed)</option>
                            <option value="logout">Logout</option>
                            <option value="file_scan">File Scan</option>
                            <option value="password_check">Password Check</option>
                            <option value="password_generate">Password Generate</option>
                            <option value="ssl_check">SSL Check</option>
                            <option value="port_scan">Port Scan</option>
                            <option value="note_create">Note Create</option>
                            <option value="note_decrypt">Note Decrypt</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Status</label>
                        <select name="status" class="form-select">
                            <option value="">All Status</option>
                            <option value="success">Success</option>
                            <option value="failed">Failed</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Filter</button>
                            <a href="{{ url_for('admin_activity_logs') }}" class="btn btn-outline-secondary">Clear</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Stats Summary -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-primary">{{ stats.total }}</h3>
                        <p class="text-muted mb-0">Total Actions</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-success">{{ stats.success }}</h3>
                        <p class="text-muted mb-0">Successful</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-danger">{{ stats.failed }}</h3>
                        <p class="text-muted mb-0">Failed/Blocked</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-info">{{ stats.unique_users }}</h3>
                        <p class="text-muted mb-0">Active Users</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Timeline -->
        <div class="card">
            <div class="card-header">
                <h5>Activity Timeline (Last 500 events)</h5>
            </div>
            <div class="card-body">
                {% if logs %}
                    <div class="position-relative" style="padding-left: 30px; border-left: 2px solid #dee2e6; margin-left: 10px;">
                        {% for log in logs %}
                        <div class="log-entry log-{{ log.status }} card mb-3 position-relative">
                            <div class="timeline-dot"></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-7">
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="badge bg-secondary me-2">{{ log.username }}</span>
                                            <h6 class="mb-0 me-3">
                                                {% if log.action == 'login' %}üîì
                                                {% elif log.action == 'login_attempt' %}‚ö†Ô∏è
                                                {% elif log.action == 'logout' %}üîí
                                                {% elif log.action == 'file_scan' %}üõ°Ô∏è
                                                {% elif log.action == 'password_check' %}üîê
                                                {% elif log.action == 'password_generate' %}‚ö°
                                                {% elif log.action == 'ssl_check' %}üîê
                                                {% elif log.action == 'port_scan' %}üîå
                                                {% elif log.action == 'note_create' %}üìù
                                                {% elif log.action == 'note_decrypt' %}üîì
                                                {% elif log.action == 'note_delete' %}üóëÔ∏è
                                                {% else %}üìå
                                                {% endif %}
                                                {{ log.action.replace('_', ' ').title() }}
                                            </h6>
                                            <span class="badge 
                                                {% if log.status == 'success' %}bg-success
                                                {% elif log.status == 'failed' or log.status == 'blocked' %}bg-danger
                                                {% else %}bg-warning{% endif %}">
                                                {{ log.status }}
                                            </span>
                                        </div>
                                        <p class="text-muted small mb-0">
                                            {% if log.details %}{{ log.details }}{% else %}No additional details{% endif %}
                                        </p>
                                    </div>
                                    <div class="col-md-5 text-end">
                                        <small class="text-muted d-block">
                                            <strong>IP:</strong> {{ log.ip_address }}
                                        </small>
                                        <small class="text-muted d-block">
                                            <strong>Time:</strong> {{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
                                        </small>
                                        <small class="text-muted d-block" title="{{ log.user_agent }}">
                                            <strong>User Agent:</strong> {{ log.user_agent[:40] }}...
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5 text-muted">
                        <div style="font-size: 4rem;">üìã</div>
                        <p>No activity logs match your filters</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Export Options -->
        <div class="card mt-4">
            <div class="card-body">
                <h6>üìä Data Export (For ML Analysis)</h6>
                <p class="text-muted small">Export logs for anomaly detection and threat analysis</p>
                <button class="btn btn-outline-primary btn-sm" disabled>
                    üì• Export to JSON (Coming Soon)
                </button>
                <button class="btn btn-outline-success btn-sm" disabled>
                    üì§ Upload to AWS S3 (Phase 2)
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
